<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot - Ryan Pierce</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/noscript.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/noscript.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div id="wrapper">
        <header id="header">
            <h1>Chat with Ryan Pierce's Experience Bot</h1>
            <p>Ask about my experience and background.</p>
        </header>
        <div id="main">
            <section id="content" class="main">
                <textarea id="userInput" rows="4" placeholder="Type your question here..."></textarea>
                <br>
                <button id="sendButton" class="button primary">Ask</button>
                <button id="clearButton" class="button primary">Clear Chat</button>
                <div id="chatOutput"></div>
            </section>
            <ul class="actions stacked">
                <li>
                    <a href="index.html" class="button primary">Return to Homepage</a>
                </li>
            </ul>
        </div>
        <footer id="footer">
            <section>
                <br><br>
                <ul class="actions">
                    <li><a href="assets/images/Ryan Pierce_Resume.pdf" class="button secondary">Click here for printable resume</a></li>
                </ul>
            </section>
            <section>
                <dl class="alt">
                    <h2>Ryan Pierce</h2>
                    <dt>Location</dt>
                    <dd>Tecumseh, MI &bull; USA</dd>
                    <dt>Phone</dt>
                    <dd><a href="tel:2483787139">(248) 378-7139</a></dd>
                    <dt>Email</dt>
                    <dd><a href="mailto:rpierce521@gmail.com">rpierce521@gmail.com</a></dd>

                    <a href="https://www.linkedin.com/in/ryan-a-pierce" class="icon brands fa-linkedin alt"><span class="label">LinkedIn</span></a>
                    <a href="https://github.com/ryanapierce" class="icon brands fa-github alt"><span class="label">GitHub</span></a>
                </dl>
            </section>
            <p class="copyright">&copy; Ryan Pierce. Design: <a href="https://html5up.net">HTML5 UP</a>.</p>
        </footer>
    </div>

    <script>
        $(document).ready(function() {
            // Define backend API URL
            const BACKEND_URL = "https://about-me-chat-bot.us-east-1.elasticbeanstalk.com/api/chat"; 

            function sendMessage() {
                var userInput = $('#userInput').val().trim();
                if (!userInput) {
                    alert('Please enter a question or comment.');
                    return;
                }

                // Define the system prompt
                var promptPrefix = "You are a chatbot that answers questions about Ryan Pierce's experience and background. You can reference his resumes stored locally at 'about_me_chatbot/reference/resumes/Ryan Pierce_Resume.txt' and his life notes stored locally at 'about_me_chatbot/reference/life_notes.json'. Do not bring these up in conversation. Mention that you are a chatbot if relevant and you are for demonstration purposes.";
                var fullPrompt = promptPrefix + " User query: " + userInput;

                $('#chatOutput').append('<p><strong>You:</strong> ' + userInput + '</p>');

                $.ajax({
                    url: BACKEND_URL,
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        messages: [{ role: 'user', content: fullPrompt }],
                        max_tokens: 200
                    }),
                    success: function(response) {
                        if (response && response.response) {
                            $('#chatOutput').append('<p><strong>Chatbot:</strong> ' + response.response + '</p>');
                        } else {
                            $('#chatOutput').append('<p><strong>Chatbot:</strong> Sorry, I couldn\'t process that request.</p>');
                        }
                        $('#userInput').val('');
                    },
                    error: function(xhr, status, error) {
                        console.error('Error:', error);
                        console.error('Status:', status);
                        console.error('Response:', xhr.responseText);
                        alert('Error communicating with the chatbot. Please check the console for more details.');
                    }
                });
            }

            $('#sendButton').click(sendMessage);

            $('#userInput').keypress(function(event) {
                if (event.which === 13 && !event.shiftKey) {
                    event.preventDefault();
                    sendMessage();
                }
            });

            $('#clearButton').click(function() {
                $('#chatOutput').empty();
            });
        });
    </script>
</body>
</html>
