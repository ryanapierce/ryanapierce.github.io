packages:
  yum:
    python3.11: []
    python3.11-pip: []

container_commands:
  01_create_venv:
    command: "mkdir -p /var/app/venv && python3.11 -m venv /var/app/venv"
    leader_only: true

  02_fix_permissions:
    command: |
      if [ -d /var/app/venv ]; then
        chown -R webapp:webapp /var/app/venv/
        chmod -R 775 /var/app/venv/
      fi

  03_upgrade_pip:
    command: "sudo -u webapp /var/app/venv/bin/pip install --upgrade pip setuptools"

  04_install_requirements:
    command: "sudo -u webapp /var/app/venv/bin/pip install --no-cache-dir -r /var/app/staging/requirements.txt"

option_settings:
  aws:elasticbeanstalk:container:python:
    WSGIPath: application:application
  aws:autoscaling:launchconfiguration:
    EC2KeyName: new-key-pair
