packages:
  yum:
    python3.11: []
    python3.11-pip: []

container_commands:
  01_move_requirements:
    command: |
      if [ -f /var/app/staging/assets/projects/about-me-chat-bot/requirements.txt ]; then
        mv /var/app/staging/assets/projects/about-me-chat-bot/requirements.txt /var/app/staging/requirements.txt
      fi

  02_create_venv:
    command: "mkdir -p /var/app/venv && python3.11 -m venv /var/app/venv"
    leader_only: true

  03_fix_permissions:
    command: |
      if [ -d /var/app/venv ]; then
        chown -R webapp:webapp /var/app/venv/
        chmod -R 775 /var/app/venv/
      fi

  04_install_requirements:
    command: "sudo -u webapp /var/app/venv/bin/pip install --no-cache-dir -r /var/app/staging/requirements.txt"

option_settings:
  aws:elasticbeanstalk:container:python:
    WSGIPath: application:application
  aws:autoscaling:launchconfiguration:
    EC2KeyName: new-key-pair

